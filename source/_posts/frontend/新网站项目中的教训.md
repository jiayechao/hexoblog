---
title: 新网站项目中的教训
date: 2016-08-10 09:35:44
categories:
- 项目经验
tags: 
- 项目经验
---
## 前言
---本文系刚接触前端做的第一个项目---
顺便安利一下我们的网站[www.4fang.net][3]
新版网站开发周期又臭又长，搞了这么久，原因有很多，以下我会从项目初始到项目结束各个开发节点做一个总结，一个算作自己的成长，另外作为经验分享，希望后来者，更希望自己在以后的项目中吸取教训，再接再厉！

## 项目初始
我和xx(同事)都是以前没有整站开发的经验，当听说要重新开发一个网站的时候，一个是兴奋，终于可以动手做一个属于自己的网站，另一个是忐忑，毕竟两个菜鸟，好多东西都不懂，完全不知道从何开始。项目开始之前，我们开了个小会，陈经理简单说了一些开发的事项及简单流程，大概有以下：

 1. 约定一个数据结构，也就是一个页面的数据包括那些结构及排列，比如标题，回复，点击数，浏览数等等；
 2. 定义一个协议，前端请求数据时返回标准格式，具体来说就是类似下面的格式，`{"status":"ok","data":{},"error":""}`,返回的数据都在这个json中；
 3. 定义了一个网站排版的大体结构，比如导航条和侧边栏，网站要做成什么形式（样式）；

这三点定义好后，基本并不会改变，相当于一座房子的基底，出了问题或者改变需求，就是推倒重来的严重后果，可惜我们每次都是栽在这个上面。

##  项目开发
### 原型图
我们首先做的是大概商量一个原型图出来，就是简单的用铅笔在A4纸上画出网页的大概布局及摆放方式，比如下面这些
![enter description here][1]
![enter description here][2]
实际上这些简单的原型有几十张，每个页面要有pc端和平板及手机屏幕的不同展现，之间加上简单的交互。现在看来，虽然有些原始，但我推荐如果项目没有设计人员和交互人员，开始写代码之前，还是要自己画画，心里有个底。
### 数据结构
先贴一下我们商定的数据结构
```JSON
{
    "_id" : "40169",
    "auth" : {
        "_id" : "fighting",
        "name" : "超帅"
    },
    "theme" : "求助",
    "title" : "哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇",
    "content" : "
哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇哇
",
    "createtime" : ISODate("2016-07-27T09:25:58.991Z"),
    "replyNum" : 2,
    "clickNum" : 10,
    "state" : 1,
    "missionTag" : 0,
    "editable" : "true",
    "dtype" : "all",
    "META_KEYWORDS" : [],
    "lastTime" : ISODate("2016-07-27T09:52:52.373Z"),
    "reply" : [ 
        {
            "discussname" : {
                "_id" : "fighting",
                "name" : "超帅"
            },
            "content" : "111111111111111",
            "createtime" : ISODate("2016-07-27T09:26:09.567Z"),
            "floor" : "0",
            "reply" : [ 
                {
                    "replyname" : {
                        "_id" : "fighting",
                        "name" : "超帅"
                    },
                    "author" : "",
                    "content" : "22222222222222",
                    "createtime" : ISODate("2016-07-27T09:26:13.678Z"),
                    "floor" : "0_0"
                }, 
                {
                    "replyname" : {
                        "_id" : "fighting",
                        "name" : "超帅"
                    },
                    "author" : "回复：超帅",
                    "content" : "33333333333333333333",
                    "createtime" : ISODate("2016-07-27T09:26:18.318Z"),
                    "floor" : "0_1"
                }
            ],
            "replyNum" : 2
        }, 
        {
            "discussname" : {
                "_id" : "fighting",
                "name" : "超帅"
            },
            "content" : "222222222222222222222222",
            "createtime" : ISODate("2016-07-27T09:52:52.371Z"),
            "floor" : "1"
        }
    ]
}
```
这样的结构区别于原来的，将整篇帖子放在一个json中，区别于原来的回复内容在另一个表中。这样做有好处也有坏处，好处是我只要查找id就可以在一个表中找到所有想要的东西，简单明了，坏处就是如果我想单独取一个回复，就需要通过mongodb中的高级方法——聚合管道；
### 静态页面
最终确定了现今网站的大体结构，响应式，左右结构。
首先是左右结构：互联网上大都是左边固定右边自适应，通过定位和浮动可以轻松实现，但也有一些注意的地方，因为自适应区域通常是放主体内容，所以为了seo，在html中我们最好写在前边，我们的是右边侧边栏左边自适应，自然而然我们会写在前面，但也有个问题，定位的话只能通过相对或绝对定位才能做到，这样的话下面的内容因为相对定位展示上会很尴尬。最后我决定采用多一层嵌套标签的做法，虽然多了一层标签，但样式很好控制。
```html
<div id="wrap">
  <div id="content" style="height:140px;">
    <div id="contentb">
      content自适应区，在前面
    div>
  div>
  <div id="sidebar" style="height:240px;">sidebar固定宽度区div>
div>
```
```css
#sidebar {
    width: 300px; float: right;
  }
  #content {
    margin-left: -310px; float: left; width: 100%;
  }
  #contentb {
    margin-left: 310px;
  }
```
然后是响应式：响应式页面是指在不同屏幕大小下尽可能优雅的显示需要的内容。请注意，不是显示所有内容，也不是固定内容，而是通过页面大小来决定显示那些内容，不显示哪些内容。这就需要我们精准控制不同的元素，这也决定了响应式有他自己的局限——页面元素众多，交互繁杂的网站不建议使用。国内很多网站在这方面都有例子，比如淘宝等购物网站。我们的网站结构简单，比较适合响应式。
### 前后台交互
这是整个项目中最最最坑的地方，也是项目中最耗时的阶段。若果细细到来，绝对可以写个五章九百回合小说!我简单说几点：

 1. 当访问一个网站的时候，我们可以看到他会整体显示出来，然后加载一些不是很重要或者不必要浏览者及时看到的东西，比如广告，侧边栏。当然我们的网站也是这样做的，不同的是，我们控制的元素实在太多了，登录名，侧边栏，树结构，而且这些都是大段的HTML代码，在刚开始没有使用模板的时候，你可以想象动辄几十行的字符串，双引号,单引号,加号，稍不留神就少了个标点。勉强写好后，如果后期要改，又是一个大大的工程！而且，这样做还有个缺点：如果依赖的JS库比较大，我的请求比较多，网络又比较慢，你会看到过了好几秒，突然跳出大段文字，严重影响了体验！
 2.  我们获取数据是在前端写好数据库表名，筛选的内容，然后获取数据。这个模式我不置可否，安全性方面不是很了解（个人觉得很尴尬），对于前端的影响就是，本来一个链接就能获取的数据，我要多写几十行才能拿到，一个请求几十行，一个页面几十个请求。。。当然，这样后台的压力减小很多；另一个比较尴尬的地方就是前面说的，如果我要取内嵌数组的一个单独数据，就无能为力了；
 3.  大家可以看看知乎，segmentfault等网站的发帖，回复，登录。这些操作后后台会返回一个页面，也就是说，后台的模板会根据参数对模板做出调整，比如登陆，回复提醒之类的，可惜我们自己的模板没有这些东西，这些操作只能放在前端来做，无形中又是一堆工作量，参见第一。还有个问题就是，我们的网站进行这些操作时不会整体刷新，而是通过前台添加一个临时的节点，这样做的好处很明显，我们不用再“刷新”一次页面，操作的内容背景描红，直观，体验好。但是工作量。。。呵呵；
 4.   前期的模板我们只有简单替换功能，但后来需要的功能多的时候，弊端就显露出来的，后台只能加参数，前端也要整个修改，无形中又增加了工作量；
 5.   还有两个我们网站的特色功能，任务系统和文档功能，刚开始却是毫无头绪，数据库的东西不统一，变量比较多，还需要是动态的，而且考虑到响应式，无刷新的话，我们每次点击都要重新请求，屏幕放大缩小的显示隐藏。作为一个改入行的小菜鸟，确实挺头疼的。

*。。。。。。走过来再看，这些东西虽然繁琐，其实也得到了很多锻炼*
### 测试
刚开始是兼容到 IE8 的指标做的，所以有一些属性，方法不被IE7，6支持，比如css中的inline-block，table-cell，还有js中的JSON.stringify（）方法，还有移动端（安卓，IOS）中的各种坑，都是一些小知识点，但如果没有遇到，还是会卡很久的。
## 项目线上测试
### 各版本浏览器调试
 本地有些东西测试好好的，放到线上就会有各种问题，一方面是因为我们的服务端的原因，另一方面就是前后台交互之间存在瑕疵，这些只是一些小问题，很容易就搞好。
### 重构
 我觉得一个项目的需求最好在刚开始能大致固定一个框架，大家都在这个框架内修改，不要跳出框架，不然费时费力！这次重构精简了代码，将所有的css，js文件分别合成一个文件，减少了请求。

*现在回过头来看自己写的这些东西，有些欠考虑，有些太简单，不过总归是从这里开始的，加油*

  [1]: /blog/imgs/frontend/prototype1.png "prototype1.png"
  [2]: /blog/imgs/frontend/prototype2.png "prototype2.png"
  [3]: http://www.4fang.net
